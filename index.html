<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Monte seu Bolo - Fafa Bolos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f8f8;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .header {
            background: #fff;
            padding: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.25rem;
            font-weight: 700;
            color: #ea1d2c;
        }

        .btn-admin {
            padding: 0.5rem 1rem;
            background: #ea1d2c;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-back {
            background: none;
            border: none;
            color: #ea1d2c;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .container {
            padding: 1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .progress-bar {
            background: #fff;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .progress-steps {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }

        .progress-line {
            position: absolute;
            top: 18px;
            left: 40px;
            right: 40px;
            height: 2px;
            background: #e0e0e0;
            z-index: 0;
        }

        .progress-line-fill {
            height: 100%;
            background: #ea1d2c;
            transition: width 0.3s;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .step-circle {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
            color: #999;
            transition: all 0.3s;
        }

        .progress-step.active .step-circle {
            background: #ea1d2c;
            color: white;
        }

        .progress-step.completed .step-circle {
            background: #00a65a;
            color: white;
        }

        .step-label {
            font-size: 0.75rem;
            color: #666;
            font-weight: 500;
        }

        .progress-step.active .step-label {
            color: #ea1d2c;
            font-weight: 600;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #333;
        }

        .options-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .option-item {
            background: #fff;
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            gap: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .option-item:active {
            transform: scale(0.98);
        }

        .option-item.selected {
            border-color: #ea1d2c;
            background: #fff5f5;
        }

        .option-image {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .option-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .option-name {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.25rem;
        }

        .option-description {
            font-size: 0.875rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .option-price {
            font-size: 1.125rem;
            font-weight: 700;
            color: #ea1d2c;
        }

        .option-radio {
            width: 24px;
            height: 24px;
            border: 2px solid #ddd;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .option-item.selected .option-radio {
            border-color: #ea1d2c;
            background: #ea1d2c;
        }

        .option-item.selected .option-radio::after {
            content: '‚úì';
            color: white;
            font-size: 0.875rem;
            font-weight: 700;
        }

        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #fff;
            padding: 1rem;
            box-shadow: 0 -2px 12px rgba(0,0,0,0.1);
            z-index: 99;
        }

        .bottom-content {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .total-info {
            flex: 1;
        }

        .total-label {
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 0.25rem;
        }

        .total-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
        }

        .btn-continue {
            padding: 1rem 2rem;
            background: #ea1d2c;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .btn-continue:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-continue:active:not(:disabled) {
            transform: scale(0.95);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: flex-end;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #fff;
            border-radius: 20px 20px 0 0;
            padding: 1.5rem;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #666;
            cursor: pointer;
            padding: 0.5rem;
        }

        .summary-item {
            padding: 1rem;
            background: #f8f8f8;
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }

        .summary-label {
            font-size: 0.875rem;
            color: #666;
            margin-bottom: 0.25rem;
        }

        .summary-value {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
        }

        .payment-notice {
            background: #fff3cd;
            border-left: 4px solid #f39c12;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-size: 0.875rem;
            color: #856404;
        }

        .btn-whatsapp {
            width: 100%;
            padding: 1rem;
            background: #25D366;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .admin-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-weight: 600;
            color: #666;
            white-space: nowrap;
            cursor: pointer;
        }

        .tab-btn.active {
            background: #ea1d2c;
            color: white;
            border-color: #ea1d2c;
        }

        .items-grid {
            display: grid;
            gap: 1rem;
        }

        .item-card {
            background: #fff;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .item-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-edit,
        .btn-delete {
            flex: 1;
            padding: 0.5rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-edit {
            background: #f39c12;
            color: white;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-add {
            width: 100%;
            padding: 1rem;
            background: #00a65a;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            cursor: pointer;
        }

        .group-section {
            background: #fff;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .group-name {
            font-size: 1.125rem;
            font-weight: 700;
            color: #333;
        }

        .btn-group-action {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
        }

        .hidden {
            display: none !important;
        }

        .step-content {
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">üéÇ Fafa Bolos</div>
            <button class="btn-admin" onclick="showLogin()" id="adminBtn">üîê Admin</button>
        </div>
    </header>

    <div class="container">
        <div id="clientPage">
            <div class="progress-bar">
                <div class="progress-steps" id="progressSteps"></div>
            </div>
            <div id="stepContents"></div>
        </div>

        <div id="adminPage" class="hidden">
            <div class="admin-tabs">
                <button class="tab-btn active" onclick="showTab('grupos')">üìÅ Grupos</button>
                <button class="tab-btn" onclick="showTab('itens')">üç∞ Itens</button>
                <button class="tab-btn" onclick="showTab('config')">‚öôÔ∏è Configura√ß√µes</button>
            </div>

            <div id="tabGrupos">
                <button class="btn-add" onclick="showGroupForm()">‚ûï Adicionar Grupo</button>
                <div id="groupsList"></div>
            </div>

            <div id="tabItens" class="hidden">
                <button class="btn-add" onclick="showItemForm()">‚ûï Adicionar Item</button>
                <div class="items-grid" id="itemsList"></div>
            </div>

            <div id="tabConfig" class="hidden">
                <div class="group-section">
                    <h3 style="margin-bottom: 1rem; color: #333;">üìä Integra√ß√£o Google Sheets</h3>
                    
                    <div class="form-group">
                        <label>Link da Planilha Publicada</label>
                        <input type="text" id="sheetUrl" placeholder="Cole o link da planilha aqui">
                        <small style="color: #666; display: block; margin-top: 0.5rem;">
                            Publique sua planilha: Arquivo ‚Üí Compartilhar ‚Üí Publicar na Web
                        </small>
                    </div>
                    
                    <button class="btn-add" onclick="saveSheetUrl()">üíæ Salvar Link</button>
                    <button class="btn-admin" style="width: 100%; margin-top: 0.5rem; background: #00a65a;" onclick="syncWithSheet()">
                        üîÑ Sincronizar Agora
                    </button>
                    
                    <div id="syncStatus" style="margin-top: 1rem; padding: 1rem; background: #f8f8f8; border-radius: 8px; display: none;">
                        <div id="syncMessage"></div>
                    </div>
                </div>

                <div class="group-section">
                    <h3 style="margin-bottom: 1rem; color: #333;">üì± WhatsApp</h3>
                    
                    <div class="form-group">
                        <label>N√∫mero do WhatsApp (com DDI)</label>
                        <input type="text" id="whatsappNumber" placeholder="Ex: 5561991944143" maxlength="13">
                        <small style="color: #666; display: block; margin-top: 0.5rem;">
                            Formato: 55 (BR) + DDD + N√∫mero (apenas n√∫meros)
                        </small>
                    </div>
                    
                    <button class="btn-add" onclick="saveWhatsApp()">üíæ Salvar WhatsApp</button>
                </div>

                <div class="group-section">
                    <h3 style="margin-bottom: 1rem; color: #333;">üóëÔ∏è Dados Locais</h3>
                    <p style="color: #666; margin-bottom: 1rem; font-size: 0.875rem;">
                        Os dados s√£o salvos localmente no navegador. Use a planilha para sincronizar entre dispositivos.
                    </p>
                    <button class="btn-admin" style="width: 100%; background: #dc3545;" onclick="clearLocalData()">
                        üóëÔ∏è Limpar Dados Locais
                    </button>
                </div>
            </div>

            <button class="btn-admin" style="width: 100%; margin-top: 1rem;" onclick="logout()">Sair</button>
        </div>
    </div>

    <div class="bottom-bar" id="bottomBar">
        <div class="bottom-content">
            <div class="total-info">
                <div class="total-label">Total</div>
                <div class="total-price" id="totalPrice">R$ 0,00</div>
            </div>
            <button class="btn-continue" id="continueBtn" onclick="handleContinue()" disabled>
                Continuar
            </button>
        </div>
    </div>

    <div class="modal" id="summaryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Resumo do Pedido</h3>
                <button class="close-btn" onclick="closeModal('summaryModal')">‚úï</button>
            </div>
            
            <div id="summaryItems"></div>

            <div class="payment-notice">
                <strong>‚ö†Ô∏è Importante:</strong> Pagamento de 50% como sinal. O restante na entrega.
            </div>

            <div style="text-align: center; margin: 1rem 0;">
                <div style="font-size: 0.875rem; color: #666;">Valor Total</div>
                <div style="font-size: 2rem; font-weight: 700; color: #ea1d2c;" id="summaryTotal">R$ 0,00</div>
            </div>

            <button class="btn-whatsapp" onclick="sendWhatsApp()">
                üì± Fazer Pedido pelo WhatsApp
            </button>
        </div>
    </div>

    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Login Admin</h3>
                <button class="close-btn" onclick="closeModal('loginModal')">‚úï</button>
            </div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Usu√°rio</label>
                    <input type="text" id="loginUser" required>
                </div>
                <div class="form-group">
                    <label>Senha</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn-whatsapp" style="background: #ea1d2c;">Entrar</button>
            </form>
        </div>
    </div>

    <div class="modal" id="groupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="groupModalTitle">Adicionar Grupo</h3>
                <button class="close-btn" onclick="closeModal('groupModal')">‚úï</button>
            </div>
            <form onsubmit="saveGroup(event)">
                <div class="form-group">
                    <label>Nome do Grupo</label>
                    <input type="text" id="groupName" placeholder="Ex: Massas Especiais" required>
                </div>
                <div class="form-group">
                    <label>√çcone (Emoji)</label>
                    <input type="text" id="groupIcon" placeholder="Ex: üç∞" maxlength="2" required>
                </div>
                <div class="form-group">
                    <label>Ordem de Exibi√ß√£o</label>
                    <input type="number" id="groupOrder" min="1" required>
                </div>
                <button type="submit" class="btn-whatsapp" style="background: #00a65a;">Salvar</button>
            </form>
        </div>
    </div>

    <div class="modal" id="itemModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="itemModalTitle">Adicionar Item</h3>
                <button class="close-btn" onclick="closeModal('itemModal')">‚úï</button>
            </div>
            <form onsubmit="saveItem(event)">
                <div class="form-group">
                    <label>Grupo</label>
                    <select id="itemGroup" required></select>
                </div>
                <div class="form-group">
                    <label>Nome</label>
                    <input type="text" id="itemName" required>
                </div>
                <div class="form-group">
                    <label>Descri√ß√£o</label>
                    <textarea id="itemDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Pre√ßo (R$)</label>
                    <input type="number" id="itemPrice" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>URL da Imagem</label>
                    <input type="text" id="itemImage" placeholder="Ex: img/chocolate.jpg" required>
                    <small style="color: #666; display: block; margin-top: 0.5rem;">
                        Coloque as imagens na pasta "img" do GitHub
                    </small>
                </div>
                <button type="submit" class="btn-whatsapp" style="background: #00a65a;">Salvar</button>
            </form>
        </div>
    </div>

    <script>
        let currentUser = null;
        let currentTab = 'grupos';
        let currentStepIndex = 0;
        let editingGroupId = null;
        let editingItemId = null;
        
        let groups = [];
        let items = [];
        let selections = {};
        
        let WHATSAPP_NUMBER = '5561991944143';
        let SHEET_URL = '';

        function loadData() {
            const defaultGroups = [
                { id: 1, nome: 'Massas', icone: 'üç∞', ordem: 1 },
                { id: 2, nome: 'Recheios', icone: 'üçì', ordem: 2 },
                { id: 3, nome: 'Coberturas', icone: 'üé®', ordem: 3 }
            ];
            
            const defaultItems = [
                { id: 1, grupoId: 1, nome: 'Chocolate', descricao: 'Massa fofinha de chocolate belga', preco: 25.00, imagem: 'img/chocolate.jpg' },
                { id: 2, grupoId: 1, nome: 'Baunilha', descricao: 'Massa cl√°ssica de baunilha', preco: 20.00, imagem: 'img/baunilha.jpg' },
                { id: 3, grupoId: 2, nome: 'Brigadeiro', descricao: 'Cremoso brigadeiro gourmet', preco: 15.00, imagem: 'img/brigadeiro.jpg' },
                { id: 4, grupoId: 2, nome: 'Doce de Leite', descricao: 'Doce de leite cremoso', preco: 12.00, imagem: 'img/doce-leite.jpg' },
                { id: 5, grupoId: 3, nome: 'Ganache', descricao: 'Chocolate meio amargo', preco: 18.00, imagem: 'img/ganache.jpg' },
                { id: 6, grupoId: 3, nome: 'Chantilly', descricao: 'Chantilly tradicional', preco: 15.00, imagem: 'img/chantilly.jpg' }
            ];

            groups = JSON.parse(localStorage.getItem('groups')) || defaultGroups;
            items = JSON.parse(localStorage.getItem('items')) || defaultItems;
            
            SHEET_URL = localStorage.getItem('sheetUrl') || '';
            WHATSAPP_NUMBER = localStorage.getItem('whatsappNumber') || '5561991944143';
            
            saveData();
        }

        function saveData() {
            localStorage.setItem('groups', JSON.stringify(groups));
            localStorage.setItem('items', JSON.stringify(items));
        }

        function getGroupsByOrder() {
            return groups.sort((a, b) => a.ordem - b.ordem);
        }

        function getItemsByGroup(groupId) {
            return items.filter(item => item.grupoId === groupId);
        }

        function buildClientInterface() {
            const orderedGroups = getGroupsByOrder();
            const progressSteps = document.getElementById('progressSteps');
            
            progressSteps.innerHTML = `
                <div class="progress-line">
                    <div class="progress-line-fill" id="progressFill" style="width: 0%"></div>
                </div>
                ${orderedGroups.map((group, index) => `
                    <div class="progress-step ${index === 0 ? 'active' : ''}" data-step="${index}">
                        <div class="step-circle">${index + 1}</div>
                        <div class="step-label">${group.nome}</div>
                    </div>
                `).join('')}
            `;
            
            const stepContents = document.getElementById('stepContents');
            stepContents.innerHTML = orderedGroups.map((group, index) => `
                <div id="step${index}" class="step-content ${index !== 0 ? 'hidden' : ''}">
                    <div class="section-header">
                        <h2 class="section-title">Escolha ${group.nome}</h2>
                        ${index > 0 ? '<button class="btn-back" onclick="goBack()">‚Üê Voltar</button>' : ''}
                    </div>
                    <div class="options-list" id="options${index}"></div>
                </div>
            `).join('');
        }

        function renderClientOptions() {
            const orderedGroups = getGroupsByOrder();
            orderedGroups.forEach((group, index) => {
                const groupItems = getItemsByGroup(group.id);
                renderOptions(groupItems, `options${index}`, index, group.id);
            });
        }

        function renderOptions(itemsList, containerId, stepIndex, groupId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const selected = selections[groupId];
            
            container.innerHTML = itemsList.length > 0 ? itemsList.map(item => `
                <div class="option-item ${selected?.id === item.id ? 'selected' : ''}" 
                     onclick="selectItem(${groupId}, ${item.id}, ${stepIndex})">
                    <img src="${item.imagem}" alt="${item.nome}" class="option-image" 
                         onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect fill=%22%23f0f0f0%22 width=%22200%22 height=%22200%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22 font-size=%2260%22%3EüñºÔ∏è%3C/text%3E%3C/svg%3E'">
                    <div class="option-info">
                        <div class="option-name">${item.nome}</div>
                        <div class="option-description">${item.descricao}</div>
                        <div class="option-price">R$ ${item.preco.toFixed(2)}</div>
                    </div>
                    <div class="option-radio"></div>
                </div>
            `).join('') : '<div class="loading">Nenhum item dispon√≠vel</div>';
        }

        function selectItem(groupId, itemId, stepIndex) {
            const item = items.find(i => i.id === itemId);
            selections[groupId] = item;
            renderOptions(getItemsByGroup(groupId), `options${stepIndex}`, stepIndex, groupId);
            updateBottomBar();
        }

        function updateBottomBar() {
            let total = 0;
            Object.values(selections).forEach(item => {
                if (item) total += item.preco;
            });
            
            document.getElementById('totalPrice').textContent = `R$ ${total.toFixed(2)}`;
            
            const continueBtn = document.getElementById('continueBtn');
            const orderedGroups = getGroupsByOrder();
            const currentGroup = orderedGroups[currentStepIndex];
            
            if (currentGroup && selections[currentGroup.id]) {
                continueBtn.disabled = false;
                if (currentStepIndex === orderedGroups.length - 1) {
                    continueBtn.textContent = 'Ver Resumo';
                } else {
                    continueBtn.textContent = 'Continuar';
                }
            } else {
                continueBtn.disabled = true;
            }
        }

        function handleContinue() {
            const orderedGroups = getGroupsByOrder();
            if (currentStepIndex < orderedGroups.length - 1) {
                currentStepIndex++;
                showStepContent(currentStepIndex);
            } else {
                showSummary();
            }
        }

        function goBack() {
            if (currentStepIndex > 0) {
                currentStepIndex--;
                showStepContent(currentStepIndex);
            }
        }

        function showStepContent(stepIndex) {
            currentStepIndex = stepIndex;
            const orderedGroups = getGroupsByOrder();
            
            orderedGroups.forEach((group, index) => {
                const stepElement = document.getElementById(`step${index}`);
                if (stepElement) {
                    stepElement.classList.toggle('hidden', index !== stepIndex);
                }
            });
            
            const steps = document.querySelectorAll('.progress-step');
            steps.forEach((s, index) => {
                s.classList.remove('active', 'completed');
                if (index === stepIndex) {
                    s.classList.add('active');
                } else if (index < stepIndex) {
                    s.classList.add('completed');
                }
            });
            
            const progress = orderedGroups.length > 1 ? (stepIndex / (orderedGroups.length - 1)) * 100 : 0;
            const progressFill = document.getElementById('progressFill');
            if (progressFill) {
                progressFill.style.width = progress + '%';
            }
            
            updateBottomBar();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showSummary() {
            const orderedGroups = getGroupsByOrder();
            const summaryItems = document.getElementById('summaryItems');
            
            summaryItems.innerHTML = orderedGroups.map(group => {
                const item = selections[group.id];
                return `
                    <div class="summary-item">
                        <div class="summary-label">${group.icone} ${group.nome}</div>
                        <div class="summary-value">${item ? `${item.nome} - R$ ${item.preco.toFixed(2)}` : '-'}</div>
                    </div>
                `;
            }).join('');
            
            let total = 0;
            Object.values(selections).forEach(item => {
                if (item) total += item.preco;
            });
            
            document.getElementById('summaryTotal').textContent = `R$ ${total.toFixed(2)}`;
            document.getElementById('summaryModal').classList.add('active');
        }

        function sendWhatsApp() {
            let total = 0;
            let message = 'üéÇ *Novo Pedido - Fafa Bolos*\n\n';
            message += '*MEU BOLO PERSONALIZADO:*\n\n';
            
            const orderedGroups = getGroupsByOrder();
            orderedGroups.forEach(group => {
                const item = selections[group.id];
                if (item) {
                    message += `${group.icone} *${group.nome}:* ${item.nome}\n`;
                    message += `   R$ ${item.preco.toFixed(2)}\n\n`;
                    total += item.preco;
                }
            });
            
            const sinal = total * 0.5;
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            message += `üí∞ *VALOR TOTAL: R$ ${total.toFixed(2)}*\n\n`;
            message += `‚ö†Ô∏è *IMPORTANTE:*\n`;
            message += `üìå Sinal de 50%: *R$ ${sinal.toFixed(2)}*\n`;
            message += `üìå Restante na entrega: R$ ${(total - sinal).toFixed(2)}`;

            const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

        function showLogin() {
            document.getElementById('loginModal').classList.add('active');
        }

        function handleLogin(event) {
            event.preventDefault();
            const user = document.getElementById('loginUser').value;
            const password = document.getElementById('loginPassword').value;

            if (user.toLowerCase() === 'fafa' && password === '1050') {
                currentUser = { user: 'fafa' };
                closeModal('loginModal');
                showAdminPage();
            } else {
                alert('Usu√°rio ou senha incorretos!');
            }
        }

        function showAdminPage() {
            document.getElementById('clientPage').classList.add('hidden');
            document.getElementById('adminPage').classList.remove('hidden');
            document.getElementById('bottomBar').classList.add('hidden');
            document.getElementById('adminBtn').textContent = 'üë§ ' + currentUser.user;
            loadConfigValues();
            renderAdminGroups();
        }

        function logout() {
            currentUser = null;
            currentStepIndex = 0;
            selections = {};
            document.getElementById('clientPage').classList.remove('hidden');
            document.getElementById('adminPage').classList.add('hidden');
            document.getElementById('bottomBar').classList.remove('hidden');
            document.getElementById('adminBtn').textContent = 'üîê Admin';
            buildClientInterface();
            renderClientOptions();
        }

        function showTab(tab) {
            currentTab = tab;
            
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('tabGrupos').classList.add('hidden');
            document.getElementById('tabItens').classList.add('hidden');
            document.getElementById('tabConfig').classList.add('hidden');
            
            if (tab === 'grupos') {
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
                document.getElementById('tabGrupos').classList.remove('hidden');
                renderAdminGroups();
            } else if (tab === 'itens') {
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                document.getElementById('tabItens').classList.remove('hidden');
                renderAdminItems();
            } else if (tab === 'config') {
                document.querySelectorAll('.tab-btn')[2].classList.add('active');
                document.getElementById('tabConfig').classList.remove('hidden');
                loadConfigValues();
            }
        }

        function renderAdminGroups() {
            const container = document.getElementById('groupsList');
            const orderedGroups = getGroupsByOrder();
            
            container.innerHTML = orderedGroups.map(group => `
                <div class="group-section">
                    <div class="group-header">
                        <div>
                            <div class="group-name">${group.icone} ${group.nome}</div>
                            <div style="font-size: 0.875rem; color: #666;">Etapa ${group.ordem}</div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn-group-action btn-edit" onclick="editGroup(${group.id})">‚úèÔ∏è</button>
                            <button class="btn-group-action btn-delete" onclick="deleteGroup(${group.id})">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div style="font-size: 0.875rem; color: #666;">
                        ${getItemsByGroup(group.id).length} item(ns) cadastrado(s)
                    </div>
                </div>
            `).join('');
        }

        function renderAdminItems() {
            const container = document.getElementById('itemsList');
            
            container.innerHTML = items.map(item => {
                const group = groups.find(g => g.id === item.grupoId);
                return `
                    <div class="item-card">
                        <img src="${item.imagem}" alt="${item.nome}" class="item-image"
                             onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect fill=%22%23f0f0f0%22 width=%22200%22 height=%22200%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22 font-size=%2260%22%3EüñºÔ∏è%3C/text%3E%3C/svg%3E'">
                        <div style="font-size: 0.75rem; color: #ea1d2c; font-weight: 600; margin-bottom: 0.5rem;">
                            ${group ? group.icone + ' ' + group.nome : 'Sem grupo'}
                        </div>
                        <div style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.25rem;">${item.nome}</div>
                        <div style="font-size: 0.875rem; color: #666; margin-bottom: 0.5rem;">${item.descricao}</div>
                        <div style="font-size: 1.25rem; font-weight: 700; color: #ea1d2c;">R$ ${item.preco.toFixed(2)}</div>
                        <div class="item-actions">
                            <button class="btn-edit" onclick="editItem(${item.id})">‚úèÔ∏è Editar</button>
                            <button class="btn-delete" onclick="deleteItem(${item.id})">üóëÔ∏è Excluir</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showGroupForm(id = null) {
            editingGroupId = id;
            
            if (id) {
                const group = groups.find(g => g.id === id);
                if (group) {
                    document.getElementById('groupModalTitle').textContent = 'Editar Grupo';
                    document.getElementById('groupName').value = group.nome;
                    document.getElementById('groupIcon').value = group.icone;
                    document.getElementById('groupOrder').value = group.ordem;
                }
            } else {
                document.getElementById('groupModalTitle').textContent = 'Adicionar Grupo';
                document.getElementById('groupName').value = '';
                document.getElementById('groupIcon').value = '';
                document.getElementById('groupOrder').value = groups.length + 1;
            }
            
            document.getElementById('groupModal').classList.add('active');
        }

        function saveGroup(event) {
            event.preventDefault();
            
            const nome = document.getElementById('groupName').value;
            const icone = document.getElementById('groupIcon').value;
            const ordem = parseInt(document.getElementById('groupOrder').value);
            
            if (editingGroupId) {
                const index = groups.findIndex(g => g.id === editingGroupId);
                groups[index] = { ...groups[index], nome, icone, ordem };
            } else {
                const newGroup = { id: Date.now(), nome, icone, ordem };
                groups.push(newGroup);
            }
            
            saveData();
            closeModal('groupModal');
            renderAdminGroups();
            buildClientInterface();
            renderClientOptions();
            event.target.reset();
        }

        function editGroup(id) {
            showGroupForm(id);
        }

        function deleteGroup(id) {
            const groupItems = getItemsByGroup(id);
            if (groupItems.length > 0) {
                alert('N√£o √© poss√≠vel excluir um grupo que possui itens cadastrados!');
                return;
            }
            
            if (!confirm('Excluir este grupo?')) return;
            
            groups = groups.filter(g => g.id !== id);
            saveData();
            renderAdminGroups();
            buildClientInterface();
            renderClientOptions();
        }

        function showItemForm(id = null) {
            editingItemId = id;
            
            const groupSelect = document.getElementById('itemGroup');
            groupSelect.innerHTML = groups.map(g => 
                `<option value="${g.id}">${g.icone} ${g.nome}</option>`
            ).join('');
            
            if (id) {
                const item = items.find(i => i.id === id);
                if (item) {
                    document.getElementById('itemModalTitle').textContent = 'Editar Item';
                    document.getElementById('itemGroup').value = item.grupoId;
                    document.getElementById('itemName').value = item.nome;
                    document.getElementById('itemDescription').value = item.descricao;
                    document.getElementById('itemPrice').value = item.preco;
                    document.getElementById('itemImage').value = item.imagem;
                }
            } else {
                document.getElementById('itemModalTitle').textContent = 'Adicionar Item';
                document.getElementById('itemName').value = '';
                document.getElementById('itemDescription').value = '';
                document.getElementById('itemPrice').value = '';
                document.getElementById('itemImage').value = '';
            }
            
            document.getElementById('itemModal').classList.add('active');
        }

        function saveItem(event) {
            event.preventDefault();
            
            const grupoId = parseInt(document.getElementById('itemGroup').value);
            const nome = document.getElementById('itemName').value;
            const descricao = document.getElementById('itemDescription').value;
            const preco = parseFloat(document.getElementById('itemPrice').value);
            const imagem = document.getElementById('itemImage').value;
            
            if (editingItemId) {
                const index = items.findIndex(i => i.id === editingItemId);
                items[index] = { ...items[index], grupoId, nome, descricao, preco, imagem };
            } else {
                const newItem = { id: Date.now(), grupoId, nome, descricao, preco, imagem };
                items.push(newItem);
            }
            
            saveData();
            closeModal('itemModal');
            renderAdminItems();
            buildClientInterface();
            renderClientOptions();
            event.target.reset();
        }

        function editItem(id) {
            showItemForm(id);
        }

        function deleteItem(id) {
            if (!confirm('Excluir este item?')) return;
            
            items = items.filter(i => i.id !== id);
            saveData();
            renderAdminItems();
            buildClientInterface();
            renderClientOptions();
        }

        function loadConfigValues() {
            document.getElementById('sheetUrl').value = SHEET_URL;
            document.getElementById('whatsappNumber').value = WHATSAPP_NUMBER;
        }

        function saveSheetUrl() {
            const url = document.getElementById('sheetUrl').value.trim();
            SHEET_URL = url;
            localStorage.setItem('sheetUrl', url);
            showSyncMessage('‚úÖ Link da planilha salvo com sucesso!', 'success');
        }

        function saveWhatsApp() {
            const number = document.getElementById('whatsappNumber').value.trim();
            WHATSAPP_NUMBER = number;
            localStorage.setItem('whatsappNumber', number);
            showSyncMessage('‚úÖ N√∫mero do WhatsApp salvo com sucesso!', 'success');
        }

        async function syncWithSheet() {
            if (!SHEET_URL) {
                showSyncMessage('‚ùå Configure o link da planilha primeiro!', 'error');
                return;
            }

            showSyncMessage('üîÑ Sincronizando...', 'info');

            try {
                const sheetId = extractSheetId(SHEET_URL);
                if (!sheetId) {
                    showSyncMessage('‚ùå Link inv√°lido! Use o link de publica√ß√£o da planilha.', 'error');
                    return;
                }

                const gruposUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=Grupos`;
                const itensUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=Itens`;

                const gruposResponse = await fetch(gruposUrl);
                const gruposText = await gruposResponse.text();
                const gruposJson = JSON.parse(gruposText.substring(47).slice(0, -2));

                const itensResponse = await fetch(itensUrl);
                const itensText = await itensResponse.text();
                const itensJson = JSON.parse(itensText.substring(47).slice(0, -2));

                groups = gruposJson.table.rows.map(row => ({
                    id: parseInt(row.c[0]?.v || 0),
                    nome: row.c[1]?.v || '',
                    icone: row.c[2]?.v || 'üì¶',
                    ordem: parseInt(row.c[3]?.v || 1)
                })).filter(g => g.id > 0);

                items = itensJson.table.rows.map(row => ({
                    id: parseInt(row.c[0]?.v || 0),
                    grupoId: parseInt(row.c[1]?.v || 0),
                    nome: row.c[2]?.v || '',
                    descricao: row.c[3]?.v || '',
                    preco: parseFloat(row.c[4]?.v || 0),
                    imagem: row.c[5]?.v || ''
                })).filter(i => i.id > 0);

                saveData();
                buildClientInterface();
                renderClientOptions();
                renderAdminGroups();
                renderAdminItems();

                showSyncMessage(`‚úÖ Sincronizado! ${groups.length} grupos e ${items.length} itens carregados.`, 'success');
            } catch (error) {
                console.error('Erro na sincroniza√ß√£o:', error);
                showSyncMessage('‚ùå Erro ao sincronizar. Verifique se a planilha est√° publicada corretamente.', 'error');
            }
        }

        function extractSheetId(url) {
            const match = url.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
            return match ? match[1] : null;
        }

        function showSyncMessage(message, type) {
            const status = document.getElementById('syncStatus');
            const messageEl = document.getElementById('syncMessage');
            
            const colors = {
                success: '#d4edda',
                error: '#f8d7da',
                info: '#d1ecf1'
            };

            status.style.display = 'block';
            status.style.background = colors[type] || colors.info;
            messageEl.textContent = message;

            if (type !== 'info') {
                setTimeout(() => {
                    status.style.display = 'none';
                }, 5000);
            }
        }

        function clearLocalData() {
            if (!confirm('‚ö†Ô∏è Isso vai apagar TODOS os dados locais (grupos e itens). Tem certeza?\n\nDica: Sincronize com a planilha antes para n√£o perder nada.')) {
                return;
            }

            localStorage.removeItem('groups');
            localStorage.removeItem('items');
            
            groups = [];
            items = [];
            selections = {};
            
            loadData();
            buildClientInterface();
            renderClientOptions();
            renderAdminGroups();
            renderAdminItems();

            showSyncMessage('‚úÖ Dados locais limpos. Dados padr√£o restaurados.', 'success');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        };

        loadData();
        buildClientInterface();
        renderClientOptions();
    </script>
</body>
</html>
