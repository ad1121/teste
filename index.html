<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Monte seu Bolo - Fafa Bolos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f8f8;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .header {
            background: #fff;
            padding: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.75rem;
            font-weight: 400;
            color: #ea1d2c;
            font-family: 'Georgia', 'Palatino', serif;
            letter-spacing: 0.5px;
            text-align: center;
            flex: 1;
        }

        .btn-admin {
            padding: 0.5rem 1rem;
            background: #ea1d2c;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-back {
            background: none;
            border: none;
            color: #ea1d2c;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .container {
            padding: 1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .progress-bar {
            background: #fff;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .progress-steps {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }

        .progress-line {
            position: absolute;
            top: 18px;
            left: 40px;
            right: 40px;
            height: 2px;
            background: #e0e0e0;
            z-index: 0;
        }

        .progress-line-fill {
            height: 100%;
            background: #ea1d2c;
            transition: width 0.3s;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .step-circle {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
            color: #999;
            transition: all 0.3s;
        }

        .progress-step.active .step-circle {
            background: #ea1d2c;
            color: white;
        }

        .progress-step.completed .step-circle {
            background: #00a65a;
            color: white;
        }

        .step-label {
            font-size: 0.75rem;
            color: #666;
            font-weight: 500;
        }

        .progress-step.active .step-label {
            color: #ea1d2c;
            font-weight: 600;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #333;
        }

        .options-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .option-item {
            background: #fff;
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            gap: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .option-item:active {
            transform: scale(0.98);
        }

        .option-item.selected {
            border-color: #ea1d2c;
            background: #fff5f5;
        }

        .option-image {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .option-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .option-name {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.25rem;
        }

        .option-description {
            font-size: 0.875rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .option-price {
            font-size: 1.125rem;
            font-weight: 700;
            color: #ea1d2c;
        }

        .option-radio {
            width: 24px;
            height: 24px;
            border: 2px solid #ddd;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .option-item.selected .option-radio {
            border-color: #ea1d2c;
            background: #ea1d2c;
        }

        .option-item.selected .option-radio::after {
            content: '‚úì';
            color: white;
            font-size: 0.875rem;
            font-weight: 700;
        }

        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #fff;
            padding: 1rem;
            box-shadow: 0 -2px 12px rgba(0,0,0,0.1);
            z-index: 99;
        }

        .bottom-content {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .total-info {
            flex: 1;
        }

        .total-label {
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 0.25rem;
        }

        .total-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
        }

        .btn-continue {
            padding: 1rem 2rem;
            background: #ea1d2c;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .btn-continue:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-continue:active:not(:disabled) {
            transform: scale(0.95);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: flex-end;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #fff;
            border-radius: 20px 20px 0 0;
            padding: 1.5rem;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #666;
            cursor: pointer;
            padding: 0.5rem;
        }

        .summary-item {
            padding: 1rem;
            background: #f8f8f8;
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }

        .summary-label {
            font-size: 0.875rem;
            color: #666;
            margin-bottom: 0.25rem;
        }

        .summary-value {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
        }

        .payment-notice {
            background: #fff3cd;
            border-left: 4px solid #f39c12;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-size: 0.875rem;
            color: #856404;
        }

        .btn-whatsapp {
            width: 100%;
            padding: 1rem;
            background: #25D366;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .admin-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-weight: 600;
            color: #666;
            white-space: nowrap;
            cursor: pointer;
        }

        .tab-btn.active {
            background: #ea1d2c;
            color: white;
            border-color: #ea1d2c;
        }

        .items-grid {
            display: grid;
            gap: 1rem;
        }

        .item-card {
            background: #fff;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .item-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-edit,
        .btn-delete {
            flex: 1;
            padding: 0.5rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-edit {
            background: #f39c12;
            color: white;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-add {
            width: 100%;
            padding: 1rem;
            background: #00a65a;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            cursor: pointer;
        }

        .group-section {
            background: #fff;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .group-name {
            font-size: 1.125rem;
            font-weight: 700;
            color: #333;
        }

        .btn-group-action {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
        }

        .hidden {
            display: none !important;
        }

        .step-content {
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .sync-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: #d4edda;
            color: #155724;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">üéÇ Fafa Bolos <span id="syncBadge" class="sync-badge" style="display:none">‚úì</span></div>
            <button class="btn-admin" onclick="showLogin()" id="adminBtn">üîê Admin</button>
        </div>
    </header>

    <div class="container">
        <div id="clientPage">
            <div class="progress-bar">
                <div class="progress-steps" id="progressSteps"></div>
            </div>
            <div id="stepContents"></div>
        </div>

        <div id="adminPage" class="hidden">
            <div class="admin-tabs">
                <button class="tab-btn active" onclick="showTab('config')">‚öôÔ∏è Config</button>
                <button class="tab-btn" onclick="showTab('grupos')">üìÅ Grupos</button>
                <button class="tab-btn" onclick="showTab('itens')">üç∞ Itens</button>
            </div>

            <div id="tabConfig">
                <div class="group-section">
                    <h3 style="margin-bottom:1rem;color:#333">üîÑ Sincroniza√ß√£o Autom√°tica</h3>
                    <div style="background:#d4edda;padding:1rem;border-radius:8px;margin-bottom:1rem;border-left:4px solid #28a745">
                        <strong>‚úÖ Ativa!</strong><br>
                        <small style="color:#155724">Os dados sincronizam automaticamente com o Google Sheets sempre que voc√™ abre o site.</small>
                    </div>
                    <button class="btn-admin" style="width:100%;background:#00a65a" onclick="syncWithSheet()">üîÑ Sincronizar Agora</button>
                    <div id="syncStatus" style="margin-top:1rem;padding:1rem;background:#f8f8f8;border-radius:8px;display:none">
                        <div id="syncMessage"></div>
                    </div>
                </div>

                <div class="group-section">
                    <h3 style="margin-bottom:1rem;color:#333">üì± WhatsApp</h3>
                    <div class="form-group">
                        <label>N√∫mero (com DDI)</label>
                        <input type="text" id="whatsappNumber" placeholder="5561991944143" maxlength="13">
                        <small style="color:#666;display:block;margin-top:0.5rem">Formato: 55 + DDD + N√∫mero</small>
                    </div>
                    <button class="btn-add" onclick="saveWhatsApp()">üíæ Salvar</button>
                </div>
            </div>

            <div id="tabGrupos" class="hidden">
                <div id="groupsList"></div>
            </div>

            <div id="tabItens" class="hidden">
                <div class="items-grid" id="itemsList"></div>
            </div>

            <button class="btn-admin" style="width:100%;margin-top:1rem" onclick="logout()">Sair</button>
        </div>
    </div>

    <div class="bottom-bar" id="bottomBar">
        <div class="bottom-content">
            <div class="total-info">
                <div class="total-label">Total</div>
                <div class="total-price" id="totalPrice">R$ 0,00</div>
            </div>
            <button class="btn-continue" id="continueBtn" onclick="handleContinue()" disabled>Continuar</button>
        </div>
    </div>

    <div class="modal" id="summaryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Resumo do Pedido</h3>
                <button class="close-btn" onclick="closeModal('summaryModal')">‚úï</button>
            </div>
            <div id="summaryItems"></div>
            <div class="payment-notice"><strong>‚ö†Ô∏è Importante:</strong> Pagamento de 50% como sinal. O restante na entrega.</div>
            <div style="text-align:center;margin:1rem 0">
                <div style="font-size:0.875rem;color:#666">Valor Total</div>
                <div style="font-size:2rem;font-weight:700;color:#ea1d2c" id="summaryTotal">R$ 0,00</div>
            </div>
            <button class="btn-whatsapp" onclick="sendWhatsApp()">üì± Fazer Pedido pelo WhatsApp</button>
        </div>
    </div>

    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Login Admin</h3>
                <button class="close-btn" onclick="closeModal('loginModal')">‚úï</button>
            </div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Usu√°rio</label>
                    <input type="text" id="loginUser" required>
                </div>
                <div class="form-group">
                    <label>Senha</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <div class="form-group" style="display:flex;align-items:center;gap:0.5rem">
                    <input type="checkbox" id="rememberMe" style="width:auto;margin:0">
                    <label for="rememberMe" style="margin:0;font-weight:normal;cursor:pointer">Manter conectado</label>
                </div>
                <button type="submit" class="btn-whatsapp" style="background:#ea1d2c">Entrar</button>
            </form>
        </div>
    </div>

    <script>
        let currentUser=null,currentTab='config',currentStepIndex=0;
        let groups=[],items=[],selections={};
        let WHATSAPP_NUMBER='5561991944143';
        const SHEET_URL='https://docs.google.com/spreadsheets/d/1sY4UdcXWEmLS-dvgKibR6s9TdFUdU_24L5qm0fuP2So/edit';

        async function loadData(){
            const synced=await syncWithSheet(true);
            if(!synced){
                groups=[{id:1,nome:'Massas',icone:'üç∞',ordem:1},{id:2,nome:'Recheios',icone:'üçì',ordem:2},{id:3,nome:'Coberturas',icone:'üé®',ordem:3}];
                items=[
                    {id:1,grupoId:1,nome:'Chocolate',descricao:'Massa fofinha',preco:25,imagem:'https://via.placeholder.com/200/8B4513/FFF?text=Chocolate'},
                    {id:2,grupoId:1,nome:'Baunilha',descricao:'Massa cl√°ssica',preco:20,imagem:'https://via.placeholder.com/200/F5DEB3/333?text=Baunilha'},
                    {id:3,grupoId:2,nome:'Brigadeiro',descricao:'Cremoso',preco:15,imagem:'https://via.placeholder.com/200/4B3621/FFF?text=Brigadeiro'},
                    {id:4,grupoId:2,nome:'Doce de Leite',descricao:'Cremoso',preco:12,imagem:'https://via.placeholder.com/200/CD853F/FFF?text=Doce'},
                    {id:5,grupoId:3,nome:'Ganache',descricao:'Chocolate',preco:18,imagem:'https://via.placeholder.com/200/3D2817/FFF?text=Ganache'},
                    {id:6,grupoId:3,nome:'Chantilly',descricao:'Tradicional',preco:15,imagem:'https://via.placeholder.com/200/FFFACD/333?text=Chantilly'}
                ];
            }
            WHATSAPP_NUMBER=localStorage.getItem('whatsappNumber')||'5561991944143';
        }

        function getGroupsByOrder(){return groups.sort((a,b)=>a.ordem-b.ordem)}
        function getItemsByGroup(gid){return items.filter(i=>i.grupoId===gid)}

        function buildClientInterface(){
            const og=getGroupsByOrder();
            const ps=document.getElementById('progressSteps');
            ps.innerHTML=`<div class="progress-line"><div class="progress-line-fill" id="progressFill" style="width:0%"></div></div>`+
                og.map((g,i)=>`<div class="progress-step ${i===0?'active':''}" data-step="${i}"><div class="step-circle">${i+1}</div><div class="step-label">${g.nome}</div></div>`).join('');
            const sc=document.getElementById('stepContents');
            sc.innerHTML=og.map((g,i)=>`<div id="step${i}" class="step-content ${i!==0?'hidden':''}">
                <div class="section-header"><h2 class="section-title">Escolha ${g.nome}</h2>${i>0?'<button class="btn-back" onclick="goBack()">‚Üê Voltar</button>':''}</div>
                <div class="options-list" id="options${i}"></div></div>`).join('');
        }

        function renderClientOptions(){
            getGroupsByOrder().forEach((g,i)=>renderOptions(getItemsByGroup(g.id),`options${i}`,i,g.id));
        }

        function renderOptions(its,cid,si,gid){
            const c=document.getElementById(cid);
            if(!c)return;
            const sel=selections[gid];
            c.innerHTML=its.length?its.map(it=>`<div class="option-item ${sel?.id===it.id?'selected':''}" onclick="selectItem(${gid},${it.id},${si})">
                <img src="${it.imagem}" alt="${it.nome}" class="option-image" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect fill=%22%23f0f0f0%22 width=%22200%22 height=%22200%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22 font-size=%2260%22%3EüñºÔ∏è%3C/text%3E%3C/svg%3E'">
                <div class="option-info"><div class="option-name">${it.nome}</div><div class="option-description">${it.descricao}</div>
                <div class="option-price">R$ ${it.preco.toFixed(2)}</div></div><div class="option-radio"></div></div>`).join(''):'<div class="loading">Nenhum item</div>';
        }

        function selectItem(gid,iid,si){
            selections[gid]=items.find(i=>i.id===iid);
            renderOptions(getItemsByGroup(gid),`options${si}`,si,gid);
            updateBottomBar();
        }

        function updateBottomBar(){
            let total=0;
            Object.values(selections).forEach(i=>{if(i)total+=i.preco});
            document.getElementById('totalPrice').textContent=`R$ ${total.toFixed(2)}`;
            const btn=document.getElementById('continueBtn');
            const og=getGroupsByOrder();
            const cg=og[currentStepIndex];
            if(cg&&selections[cg.id]){
                btn.disabled=false;
                btn.textContent=currentStepIndex===og.length-1?'Ver Resumo':'Continuar';
            }else btn.disabled=true;
        }

        function handleContinue(){
            const og=getGroupsByOrder();
            if(currentStepIndex<og.length-1){currentStepIndex++;showStepContent(currentStepIndex)}
            else showSummary();
        }

        function goBack(){if(currentStepIndex>0){currentStepIndex--;showStepContent(currentStepIndex)}}

        function showStepContent(si){
            currentStepIndex=si;
            const og=getGroupsByOrder();
            og.forEach((g,i)=>{
                const el=document.getElementById(`step${i}`);
                if(el)el.classList.toggle('hidden',i!==si);
            });
            document.querySelectorAll('.progress-step').forEach((s,i)=>{
                s.classList.remove('active','completed');
                if(i===si)s.classList.add('active');
                else if(i<si)s.classList.add('completed');
            });
            const progress=og.length>1?(si/(og.length-1))*100:0;
            const pf=document.getElementById('progressFill');
            if(pf)pf.style.width=progress+'%';
            updateBottomBar();
            window.scrollTo({top:0,behavior:'smooth'});
        }

        function showSummary(){
            const og=getGroupsByOrder();
            const si=document.getElementById('summaryItems');
            si.innerHTML=og.map(g=>{
                const item=selections[g.id];
                return`<div class="summary-item"><div class="summary-label">${g.icone} ${g.nome}</div>
                <div class="summary-value">${item?`${item.nome} - R$ ${item.preco.toFixed(2)}`:'-'}</div></div>`;
            }).join('');
            let total=0;
            Object.values(selections).forEach(i=>{if(i)total+=i.preco});
            document.getElementById('summaryTotal').textContent=`R$ ${total.toFixed(2)}`;
            document.getElementById('summaryModal').classList.add('active');
        }

        function sendWhatsApp(){
            let total=0,msg='üéÇ *Novo Pedido - Fafa Bolos*\n\n*MEU BOLO PERSONALIZADO:*\n\n';
            const og=getGroupsByOrder();
            og.forEach(g=>{
                const item=selections[g.id];
                if(item){
                    msg+=`${g.icone} *${g.nome}:* ${item.nome}\n   R$ ${item.preco.toFixed(2)}\n\n`;
                    total+=item.preco;
                }
            });
            const sinal=total*0.5;
            msg+=`‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüí∞ *VALOR TOTAL: R$ ${total.toFixed(2)}*\n\n‚ö†Ô∏è *IMPORTANTE:*\nüìå Sinal de 50%: *R$ ${sinal.toFixed(2)}*\nüìå Restante na entrega: R$ ${(total-sinal).toFixed(2)}`;
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`,'_blank');
        }

        function showLogin(){document.getElementById('loginModal').classList.add('active')}

        function handleLogin(e){
            e.preventDefault();
            const u=document.getElementById('loginUser').value;
            const p=document.getElementById('loginPassword').value;
            const r=document.getElementById('rememberMe').checked;
            if(u.toLowerCase()==='fafa'&&p==='1050'){
                currentUser={user:'fafa'};
                if(r)localStorage.setItem('savedLogin',JSON.stringify({user:'fafa',timestamp:Date.now()}));
                closeModal('loginModal');
                showAdminPage();
            }else alert('Usu√°rio ou senha incorretos!');
        }

        function showAdminPage(){
            document.getElementById('clientPage').classList.add('hidden');
            document.getElementById('adminPage').classList.remove('hidden');
            document.getElementById('bottomBar').classList.add('hidden');
            document.getElementById('adminBtn').textContent='üë§ '+currentUser.user;
            loadConfigValues();
            renderAdminGroups();
            renderAdminItems();
        }

        function logout(){
            currentUser=null;
            currentStepIndex=0;
            selections={};
            localStorage.removeItem('savedLogin');
            document.getElementById('clientPage').classList.remove('hidden');
            document.getElementById('adminPage').classList.add('hidden');
            document.getElementById('bottomBar').classList.remove('hidden');
            document.getElementById('adminBtn').textContent='üîê Admin';
            buildClientInterface();
            renderClientOptions();
        }

        function showTab(tab){
            currentTab=tab;
            document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
            document.getElementById('tabGrupos').classList.add('hidden');
            document.getElementById('tabItens').classList.add('hidden');
            document.getElementById('tabConfig').classList.add('hidden');
            if(tab==='grupos'){
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                document.getElementById('tabGrupos').classList.remove('hidden');
                renderAdminGroups();
            }else if(tab==='itens'){
                document.querySelectorAll('.tab-btn')[2].classList.add('active');
                document.getElementById('tabItens').classList.remove('hidden');
                renderAdminItems();
            }else if(tab==='config'){
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
                document.getElementById('tabConfig').classList.remove('hidden');
                loadConfigValues();
            }
        }

        function renderAdminGroups(){
            const c=document.getElementById('groupsList');
            const og=getGroupsByOrder();
            c.innerHTML=og.map(g=>`<div class="group-section"><div class="group-header"><div>
                <div class="group-name">${g.icone} ${g.nome}</div>
                <div style="font-size:0.875rem;color:#666">Etapa ${g.ordem} ‚Ä¢ ${getItemsByGroup(g.id).length} item(ns)</div>
                </div></div></div>`).join('');
        }

        function renderAdminItems(){
            const c=document.getElementById('itemsList');
            c.innerHTML=items.map(it=>{
                const gr=groups.find(g=>g.id===it.grupoId);
                return`<div class="item-card">
                    <img src="${it.imagem}" alt="${it.nome}" class="item-image" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect fill=%22%23f0f0f0%22 width=%22200%22 height=%22200%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22 font-size=%2260%22%3EüñºÔ∏è%3C/text%3E%3C/svg%3E'">
                    <div style="font-size:0.75rem;color:#ea1d2c;font-weight:600;margin-bottom:0.5rem">
                        ${gr?gr.icone+' '+gr.nome:'Sem grupo'}
                    </div>
                    <div style="font-size:1.125rem;font-weight:600;margin-bottom:0.25rem">${it.nome}</div>
                    <div style="font-size:0.875rem;color:#666;margin-bottom:0.5rem">${it.descricao}</div>
                    <div style="font-size:1.25rem;font-weight:700;color:#ea1d2c">R$ ${it.preco.toFixed(2)}</div>
                </div>`;
            }).join('');
        }

        function loadConfigValues(){
            document.getElementById('whatsappNumber').value=WHATSAPP_NUMBER;
        }

        function saveWhatsApp(){
            const n=document.getElementById('whatsappNumber').value.trim();
            WHATSAPP_NUMBER=n;
            localStorage.setItem('whatsappNumber',n);
            showSyncMessage('‚úÖ WhatsApp salvo!','success');
        }

        async function syncWithSheet(silent=false){
            if(!silent)showSyncMessage('üîÑ Sincronizando...','info');
            try{
                const sid=SHEET_URL.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)?.[1];
                if(!sid){
                    if(!silent)showSyncMessage('‚ùå Link inv√°lido!','error');
                    return false;
                }
                const gurl=`https://docs.google.com/spreadsheets/d/${sid}/gviz/tq?tqx=out:json&sheet=Grupos`;
                const iurl=`https://docs.google.com/spreadsheets/d/${sid}/gviz/tq?tqx=out:json&sheet=Itens`;
                const gr=await fetch(gurl);
                const gt=await gr.text();
                const gj=JSON.parse(gt.substring(47).slice(0,-2));
                const ir=await fetch(iurl);
                const it=await ir.text();
                const ij=JSON.parse(it.substring(47).slice(0,-2));
                groups=gj.table.rows.map(r=>({
                    id:parseInt(r.c[0]?.v||0),
                    nome:r.c[1]?.v||'',
                    icone:r.c[2]?.v||'üì¶',
                    ordem:parseInt(r.c[3]?.v||1)
                })).filter(g=>g.id>0);
                items=ij.table.rows.map(r=>({
                    id:parseInt(r.c[0]?.v||0),
                    grupoId:parseInt(r.c[1]?.v||0),
                    nome:r.c[2]?.v||'',
                    descricao:r.c[3]?.v||'',
                    preco:parseFloat(r.c[4]?.v||0),
                    imagem:r.c[5]?.v||''
                })).filter(i=>i.id>0);
                buildClientInterface();
                renderClientOptions();
                if(currentUser){
                    renderAdminGroups();
                    renderAdminItems();
                }
                if(!silent){
                    showSyncMessage(`‚úÖ Sincronizado! ${groups.length} grupos e ${items.length} itens.`,'success');
                    const badge=document.getElementById('syncBadge');
                    badge.style.display='inline-block';
                    setTimeout(()=>badge.style.display='none',3000);
                }
                return true;
            }catch(err){
                console.error('Erro:',err);
                if(!silent)showSyncMessage('‚ùå Erro ao sincronizar.','error');
                return false;
            }
        }

        function showSyncMessage(msg,type){
            const st=document.getElementById('syncStatus');
            const me=document.getElementById('syncMessage');
            const colors={success:'#d4edda',error:'#f8d7da',info:'#d1ecf1'};
            st.style.display='block';
            st.style.background=colors[type]||colors.info;
            me.textContent=msg;
            if(type!=='info')setTimeout(()=>st.style.display='none',5000);
        }

        function closeModal(mid){
            document.getElementById(mid).classList.remove('active');
        }

        window.onclick=function(e){
            if(e.target.classList.contains('modal'))e.target.classList.remove('active');
        };

        (async function init(){
            await loadData();
            buildClientInterface();
            renderClientOptions();
            const saved=localStorage.getItem('savedLogin');
            if(saved){
                try{
                    const ld=JSON.parse(saved);
                    const thirtyDays=30*24*60*60*1000;
                    if(Date.now()-ld.timestamp<thirtyDays){
                        currentUser={user:ld.user};
                        showAdminPage();
                    }else localStorage.removeItem('savedLogin');
                }catch(e){
                    localStorage.removeItem('savedLogin');
                }
            }
        })();
    </script>
</body>
</html>
